<!-- Caller BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Tue May 13 12:57:43 IST 2014 -->
<bpel:process name="Caller" targetNamespace="http://eclipse.org/bpel/sample"
	suppressJoinFailure="yes"
	xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:tns="http://eclipse.org/bpel/sample" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:ns="http://sa.ws.mine/"
	xmlns:xs="http://www.w3.org/2001/XMLSchema"
	xsi:schemaLocation="http://docs.oasis-open.org/wsbpel/2.0/process/abstract http://docs.oasis-open.org/wsbpel/2.0/OS/process/abstract/ws-bpel_abstract_common_base.xsd 
http://docs.oasis-open.org/wsbpel/2.0/process/executable http://docs.oasis-open.org/wsbpel/2.0/OS/process/executable/ws-bpel_executable.xsd
http://docs.oasis-open.org/wsbpel/2.0/plnktype http://docs.oasis-open.org/wsbpel/2.0/OS/plnktype/ws-bpel_plnktype.xsd
http://docs.oasis-open.org/wsbpel/2.0/serviceref http://docs.oasis-open.org/wsbpel/2.0/OS/serviceref/ws-bpel_serviceref.xsd 
http://docs.oasis-open.org/wsbpel/2.0/varprop http://docs.oasis-open.org/wsbpel/2.0/OS/varprop/ws-bpel_varprop.xsd">

	<!-- Import the client WSDL -->
	<bpel:import location="CallerArtifacts.wsdl" namespace="http://eclipse.org/bpel/sample"
		importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="CustomerSrv1.wsdl" namespace="http://sa.ws.mine/"
		importType="http://schemas.xmlsoap.org/wsdl/" />

	<!-- <bpel:import location="CustomerSrv2.wsdl" namespace="http://sa.ws.mine/" 
		importType="http://schemas.xmlsoap.org/wsdl/" /> -->

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->

	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="MyCallerLink"
			partnerLinkType="tns:MyCallerPLink" myRole="MyCallerPLinkRole"
			partnerRole="MyCallerPLinkRole" ></bpel:partnerLink>

		<bpel:partnerLink name="MyLink" partnerLinkType="tns:MyPLink"
			partnerRole="MyPLinkRole" initializePartnerRole="yes"></bpel:partnerLink>

	</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<bpel:variable name="inputProcess" messageType="tns:CallerRequestMessage" />
		<bpel:variable name="outputProcess" messageType="tns:CallerResponseMessage" />
		
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="inputCreateCustomer" messageType="ns:createCustomer" />

		<!-- Reference to the message that will be returned to the requester -->
		<bpel:variable name="outputCreateCustomer" messageType="ns:createCustomerResponse">
		</bpel:variable>

	</bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main">

		<!-- Receive input from requester -->
		<bpel:receive name="receiveInput" partnerLink="MyCallerLink"
			createInstance="yes" operation="process" portType="tns:Caller" variable="inputProcess" />

		<bpel:assign validate="no" name="Assign1">
	        <bpel:copy >
	            <bpel:from> <!--  part="payload" variable="inputProcess" -->
	            <bpel:literal><![CDATA[
				<customer>
					<aadhaarId>111</aadhaarId>
					<annualIncome>10000</annualIncome/>
					<countryOfBirth>IND</countryOfBirth/>
					<dob>04-JUN-2014</dob>
					<name>Name</name>
				</customer>
				]]></bpel:literal>
	            </bpel:from>
	            <bpel:to part="parameters" variable="inputCreateCustomer"/>
	        </bpel:copy>
    	</bpel:assign>
    
		<bpel:invoke name="Invoke" partnerLink="MyLink" operation="createCustomer"
			portType="ns:CustomerSrv" inputVariable="inputCreateCustomer" outputVariable="outputCreateCustomer" />

 		<bpel:assign validate="no" name="Assign2">
	 		<bpel:copy keepSrcElementName="no">
	            <bpel:from variable="outputCreateCustomer" part="parameters">
	            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[child::return]]>
                </bpel:query></bpel:from>
	            <bpel:to part="payload" variable="outputProcess">
                </bpel:to>
	        </bpel:copy>
    	</bpel:assign>
    	
    	
    <!-- 	<bpel:assign validate="no" name="Assign3">
	 		<bpel:copy >
	            <bpel:from>
	            <bpel:literal><![CDATA[<CallerResponse>]]>$strVar.value<![CDATA[</CallerResponse>]]></bpel:literal>
	            </bpel:from>
	            <bpel:to part="payload" variable="outputProcess" />
	        </bpel:copy>
    	</bpel:assign> -->
    	
		<!-- Generate reply to synchronous request -->
		<bpel:reply name="replyOutput" partnerLink="MyCallerLink"
			portType="tns:Caller" operation="process" variable="outputProcess"/>
	</bpel:sequence>
</bpel:process>

